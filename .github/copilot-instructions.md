# Nova Next • Copilot Instructions

- **Framework & entry points**: `src/main.ts` bootstraps Vue 3 + TSX, mounts `App.tsx`, and applies router plus global styles from `src/styles`; vite alias `@` targets `src/` (see `vite.config.ts`).
- **Environment context**: Wrap visual components in `NovaEnvironment` (`src/components/environment`) to propagate theme + language via `useEnvironment`; components expect `environmentProps` and pass `data-nova-theme` for theming.
- **Public surface**: `src/index.ts` re-exports `NovaButton`, `NovaInput`, `NovaColorPicker`, `NovaDropdown`, and language helpers; match this structure when adding publishable widgets so consumers share one entry module.
- **Routing + demos**: `src/router/index.ts` lazy-loads TSX views under `src/views`; demos in `src/views/demos/**` act as manual regression playgrounds, so extend these when showcasing new component capabilities.
- **Styling conventions**: Component styles live in `src/components/<name>/styles` and rely on CSS vars defined in `src/styles/themes/**`; prefer BEM-like `nova-*` class prefixes and respect `data-nova-theme` attributes toggled in `App.tsx`.
- **Language packs**: Author i18n text in `src/environments/languages/*.ts` conforming to `types/language.ts`; color picker copies strings via `environment.languageRef.value.colorPicker`.
- **Dropdown + focus mgmt**: Overlays route through `NovaDropdown` (`src/components/dropdown`) which teleports panels, traps focus with `.nova-trap`, and animates placement using `use-dropdown` + `utils/place.ts`; reuse these slots/instances instead of rolling bespoke popovers.
- **Pointer utilities**: Drag / slide behavior (HSV panel, hue/alpha bars) use `use-move`, `use-mousemove`, and `use-touchmove` to normalize pointer + touch events; wire new gestures through these hooks to keep behavior consistent across inputs.
- **Color math**: `components/color-picker/color.ts` exposes the immutable `Color` class for parsing/formatting hex, rgb, hsl and powering preset logic; prefer this helper over ad-hoc color math to stay in sync with serialization formats.
- **Testing approach**: Vitest config (`vitest.config.ts`) reuses Vite settings, runs in jsdom, and loads `tests/setup.ts` to disable transition stubs; unit specs (e.g., `components/button/__tests__`) mount TSX wrappers and snapshot HTML under `__snapshots__`.
- **E2E**: Playwright specs live in `e2e/`; config auto-starts `pnpm dev` locally or `pnpm preview` on CI and sets `baseURL` 5173/4173—no need to rewrite server hooks when adding suites.
- **Build + type safety**: `pnpm build` concurrently runs `vue-tsc --build` and `vite build` via `npm-run-all2`; keep both clean before submitting CI fixes.
- **Scripts to remember**: `pnpm dev`, `pnpm test:unit`, `pnpm test:e2e`, `pnpm lint` (runs `oxlint` + `eslint`), and `pnpm format` (Prettier + @prettier/plugin-oxc for TSX) are the expected workflows; repo targets Node 20.19+ per `package.json`.
- **Playground verification**: When changing UI/interaction-heavy components, validate `src/views/demos/*` in the dev server plus snapshot updates, then run `pnpm test:e2e --project=chromium` if dropdown or routing behavior shifts.
- **Focus & accessibility**: Dropdown + color picker rely on `aria-*` strings from language packs and keyboard handlers (`Enter`, `Escape`, `Tab` traps) defined in their TSX files; preserve these patterns when expanding props to avoid regressions.
- **Theme persistence**: `App.tsx` stores the theme in `localStorage` (`nova-theme`) and applies it via `<html data-nova-theme>`; any global styles or new layout components should read CSS vars instead of hard-coded colors to stay compatible with the switcher.
- **Publishing guardrails**: Components set `FunctionalComponent` metadata (`displayName`, `inheritAttrs`) for downstream tooling; ensure new exports follow suit so library consumers receive predictable names + attribute forwarding.
- **CI expectations**: Snapshot drift or lint failures block merges; update `__snapshots__` alongside feature changes and keep `pnpm lint:oxlint` warnings at zero (strict `correctness` rules enforced).
- **Iconography**: Color picker close button and other controls pull from `@jiangshengdev/material-design-icons-vue-next`; prefer this package (already tree-shaken) for new icons to avoid bundling duplicates.
- **Data flow mental model**: Inputs/events mutate reactive `state` objects, computed props derive render-ready values, and watchers sync `props` ↔ internal state (e.g., `NovaColorPicker` watchers on `value` and `alpha`); follow this triad to keep complex widgets predictable.
